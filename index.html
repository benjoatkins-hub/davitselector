<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boat Lifting Solution Builder — Atkins & Hoyle</title>
  <meta name="description" content="Interactive davit selector for Atkins & Hoyle products — get a recommendation and request a quote." />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --navy:#00293b; --muted:#6b7280; --border:#e6e9ec; --accent:#ff9f1c; --card:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:var(--navy);
      background: #ffffff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; padding:36px;
    }
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
    .logo{display:flex;flex-direction:column}
    .brand{font-family:'Playfair Display',serif;font-size:20px;color:var(--navy);letter-spacing:0.4px}
    .tag{font-size:12px;color:var(--muted)}

    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
    .hero{padding:24px;border-radius:8px;background:var(--card);border:1px solid var(--border)}
    h1{margin:0 0 8px 0;font-family:'Playfair Display';font-size:24px;color:var(--navy)}
    p.lead{margin:0 0 14px 0;color:var(--muted)}

    .form{background:transparent;padding:0}
    .form-group{margin-bottom:14px;padding:10px 12px}
    .form-group h4{margin:0 0 6px 0;font-size:14px;font-weight:600}
    label{display:block;font-size:13px;color:var(--navy);margin-bottom:4px}
    .row{display:flex;gap:12px;margin-bottom:12px}
    input[type=number],select{flex:1;padding:10px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--navy);outline:none;margin-bottom:8px}
    .radio-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}
    .radio{background:#fff;border:1px solid var(--border);padding:6px 8px;border-radius:6px;color:var(--navy);cursor:pointer}
    .radio input{margin-right:8px}

    .actions{display:flex;gap:12px;align-items:center;margin-top:8px}
    button.primary{background:var(--navy);border:none;color:#fff;padding:10px 16px;border-radius:6px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid var(--border);color:var(--navy);padding:9px 14px;border-radius:6px;cursor:pointer}

    .side-card{padding:18px;border-radius:8px;background:var(--card);border:1px solid var(--border)}
    .result{margin-top:14px;padding:14px;border-radius:6px;background:transparent}
    .product-title{font-family:'Playfair Display';font-size:18px;color:var(--navy)}
    .product-sub{font-size:14px;color:var(--muted);margin-top:8px}
    .product-links{margin-top:12px;display:flex;gap:8px}
    .quote{display:block;margin-top:12px}

    footer{margin-top:20px;color:var(--muted);font-size:13px}
    .wave{display:none}

    /* Product preview image (centered, responsive) */
    .product-preview{width:100%;max-width:300px;height:auto;display:block;margin:0 auto 16px auto;border-radius:6px}
    .recommendation-image {
      width: 100%;
      max-height: 260px;
      object-fit: contain;
      margin-bottom: 16px;
      border-radius: 8px;
    }
    .key-features {
      margin-top: 10px;
      padding-left: 18px;
    }
    .key-features li {
      margin-bottom: 6px;
      line-height: 1.4;
    }
    .recommended-card{display:block}

    .recommendation-summary { margin-top: 20px; }

    /* Recommendation CTA buttons (navy rectangular buttons) */
    .recommended-card .cta-row{display:flex;gap:12px;margin-top:12px}
    .recommended-card .cta-buttons{display:flex;gap:12px;margin-top:20px}
    .recommended-card .cta-button{
      background:#0b2e4f;color:#ffffff;padding:12px 20px;border-radius:6px;text-decoration:none;display:inline-block;font-weight:600;cursor:pointer;border:0;transition:background 150ms ease;border-radius:6px;
    }
    .recommended-card .cta-button:hover{background:#0e496f}

    @media(max-width:900px){.grid{grid-template-columns:1fr;}.side-card{order:2}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="brand">Atkins & Hoyle</div>
        <div class="tag">Davit Selector — Find the right lifting solution</div>
      </div>
    </header>

    <main class="grid">
      <section class="hero">
        <h1>Boat Lifting Solution Builder</h1>
        <p class="lead">Answer a few questions and we’ll recommend the right davit or crane system for your boat.</p>

        <div class="form" id="selectorForm">
          <div class="form-group">
            <h4>Weight</h4>
            <div class="row">
              <div style="flex:1">
                <label for="dinghyWeight">Dinghy Weight (lbs)</label>
                <input id="dinghyWeight" type="number" min="10" max="5000" value="300" />
              </div>
              <div style="width:160px">
                <label for="engineWeight">Outboard Engine Weight (lbs)</label>
                <input id="engineWeight" type="number" min="0" max="2000" value="0" />
              </div>
            </div>
          </div>

          <div class="form-group">
            <h4>System Type</h4>
            <div class="radio-row">
              <label class="radio"><input type="radio" name="systemType" value="davits" checked> Davits</label>
              <label class="radio"><input type="radio" name="systemType" value="crane"> Crane</label>
              <label class="radio"><input type="radio" name="systemType" value="unknown"> Don't Know</label>
            </div>
          </div>

          <div class="form-group">
            <h4>Mounting Location</h4>
            <div class="radio-row mount-options">
              <label class="radio"><input name="mount" type="radio" value="swim" checked> Swim Platform</label>
              <label class="radio"><input name="mount" type="radio" value="transom"> Transom</label>
              <label class="radio"><input name="mount" type="radio" value="rail"> Rail</label>
              <label class="radio"><input name="mount" type="radio" value="deck"> Deck</label>
              <label class="radio"><input name="mount" type="radio" value="hardtop"> Hardtop</label>
              <label class="radio"><input name="mount" type="radio" value="foredeck"> Foredeck</label>
            </div>
          </div>

          <div class="form-group">
            <h4>Options</h4>
            <!-- Boat Type removed per spec -->
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
              <div>
                <label for="tenderType">Tender Type</label>
                <select id="tenderType">
                  <option value="inflatable" selected>Inflatable</option>
                  <option value="rib">RIB</option>
                  <option value="hardskiff">Hard Skiff</option>
                </select>
              </div>
              <div>
                <label for="winchPref">Power / Winch Preference</label>
                <select id="winchPref">
                  <option value="manual">Manual</option>
                  <option value="electric">Electric</option>
                  <option value="unsure" selected>Not sure</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Mounting Surface option removed per new spec -->

          <!-- Usage Type removed per updated requirements -->

          <div class="actions">
            <button type="button" class="primary" id="recommendBtn">Get Recommendation</button>
            <button type="button" class="ghost" id="resetBtn">Reset</button>
            <a class="ghost" href="https://atkinshoyle.com/about.html">View All Products</a>
          </div>
        </div>

        <svg class="wave" viewBox="0 0 1200 120" preserveAspectRatio="none" style="width:100%;height:60px;display:block">
          <path d="M0,0 C150,100 350,0 600,40 C850,80 1050,10 1200,60 L1200 120 L0 120 Z" fill="rgba(255,255,255,0.03)"></path>
        </svg>
      </section>

      <aside class="side-card">
        <h3 style="margin:0 0 6px 0">Recommendation</h3>
        <div class="result" id="resultArea">
          <div class="product-title">No selection yet</div>
          <div class="product-sub">Fill the form and click <strong>Get Recommendation</strong> to see the best fit for your boat.</div>
        </div>

        <!-- Replaced by per-model Key Features in the recommendation card -->

        <div id="quoteArea" class="quote" style="display:none">
          <!-- Inline quote form will be injected here -->
        </div>
      </aside>
    </main>

    <footer>
      Recommendations use Atkins & Hoyle's product range (davits & cranes). For precise sizing and installation details, contact the Atkins & Hoyle team.
    </footer>
  </div>

</script>
  <script>
    // ===== main.js (inlined) =====
    // Single-file JavaScript: product catalog, recommendation rules, rendering, and event handlers

    // ===== PRODUCT CATALOG =====
    const MODELS = {
      '120': { key: '120', title: 'Model 120', capacity: 120, type: 'davit', mount: ['rail'], link: 'https://atkinshoyle.com/120-outboard-lift-capacity-of-120-lb.html', image: 'https://atkinshoyle.com/uploads/products/120-motor-lift-main.JPG', features: ['Lifts up to 120 lbs (54 kg)','Compact, lightweight design for easy handling','Rail and transom mounting options','Smooth rotation on low-friction sleeves','Includes mounting hardware and pre-rigged line'] },
      '1200r':{ key:'1200r', title:'Model 1200R', capacity:200, type:'davit', mount:['rail'], link:'https://atkinshoyle.com/1200-rotating-davits-capacity-of-200-lbs.html', image:'https://atkinshoyle.com/uploads/products/1200-rotating-davit-main.jpg', features:['200 lb rated rotating davit','Compact removable arm for neat storage','Adjustable standpipe height for reach','Smooth, low-maintenance rotation','Pre-rigged with quality line and blocks'] },
      '1400r':{ key:'1400r', title:'Model 1400R', capacity:250, type:'davit', mount:['rail'], link:'https://atkinshoyle.com/1400-rotating-davits-capacity-of-250-lbs.html', image:'https://atkinshoyle.com/uploads/products/1400-adjustable-rotating-davits-main.JPG', features:['250 lb rotating davit for larger inflatables','Adjustable angle and reach for versatile mounting','Robust cast components for longevity','Simple removal for winter storage','Complete kit with hardware and block-and-tackle'] },
      '1900r':{ key:'1900r', title:'Model 1900R', capacity:300, type:'davit', mount:['rail'], link:'https://atkinshoyle.com/1900-rotating-davits-capacity-of-300-lbs.html', image:'https://atkinshoyle.com/uploads/products/1900-rotating-adjustable-davits-main.jpg', features:['300 lb capacity with adjustable angle','Heavy-duty materials for marine environments','Smooth 360° rotation and locking collar','Ideal for 11’ RIBs and larger tenders','Supplied pre-rigged and ready to install'] },
      '1400f':{ key:'1400f', title:'Model 1400F', capacity:250, type:'davit', mount:['transom','deck','swim'], link:'https://atkinshoyle.com/1400-fixed-davits-capacity-of-250-lbs.html', image:'https://atkinshoyle.com/uploads/products/1400-fixed-adjustable-davit-main.JPG', features:['250 lb fixed davit for secure transom mounting','Adjustable base casting for custom angle','Compact, corrosion-resistant construction','Works well with small RIBs and outboards','Includes all mounting hardware'] },
      '1900f':{ key:'1900f', title:'Model 1900F', capacity:300, type:'davit', mount:['transom','deck','swim'], link:'https://atkinshoyle.com/1900-fixed-davits-capacity-of-300-lbs.html', image:'https://atkinshoyle.com/uploads/products/1900-fixed-adjustable-davit-9-main.jpg', features:['300 lb fixed davit for heavy-duty use','Adjustable angle for optimized reach','Solid cast components for long service life','Recommended for larger inflatables and motors','Complete kit with block-and-tackle'] },
      '2000':{ key:'2000', title:'Model 2000', capacity:350, type:'davit', mount:['transom','deck','swim'], link:'https://atkinshoyle.com/2000-fixed-davits-capacity-of-350-lbs.html', image:'https://atkinshoyle.com/uploads/products/2000-fixed-adjustable-cast-davit-089507.jpg', features:['350 lb rated fixed davit — high capacity, low weight','Sand-cast AlMag alloy construction for strength','Versatile mounting: deck, transom, swim platform','Optional riser arms for extended reach','Includes hardware and pre-rigged lifting line'] },
      '5000f':{ key:'5000f', title:'Model 5000F', capacity:750, type:'davit', mount:['transom','deck'], link:'https://atkinshoyle.com/5000-fixed-davits-capacity-of-750-lbs.html', image:'https://atkinshoyle.com/uploads/products/5000-fixed-adjustable-cast-davits-main.jpg', features:['Up to 750 lb lifting capacity for large tenders','Adjustable spline for precise boom angle','Heavy-duty cast construction and hardware','Optional electric winch compatibility','Complete installation kit included'] },
      '3000r':{ key:'3000r', title:'Model 3000R', capacity:300, type:'crane', mount:['deck','transom','hardtop'], link:'https://atkinshoyle.com/3000r-crane-capacity-of-300-lb.html', image:'https://atkinshoyle.com/uploads/products/3000-rotating-crane-721624.jpg', features:['300 lb rotating crane with wide reach','360° rotation and robust mounting options','Smooth manual winch with optional electric upgrade','Designed for deck, transom or hardtop installation','Supplied as a ready-to-install kit'] },
      '5000r':{ key:'5000r', title:'Model 5000R', capacity:500, type:'crane', mount:['deck','transom','hardtop'], link:'https://atkinshoyle.com/5000r-crane-capacity-of-500-lb.html', image:'https://atkinshoyle.com/uploads/products/5000r-rotating-crane-331027.jpg', features:['500 lb rotating crane for heavy lifting','Strong, corrosion-resistant components','Optional power winch for effortless operation','Collapsible design for easy storage','Ideal for larger tenders and gear'] },
      '6500t':{ key:'6500t', title:'Model 6500T', capacity:650, type:'crane', mount:['deck','hardtop'], link:'https://atkinshoyle.com/6500t-low-profile-crane-capacity-of-650-lb.html', image:'https://atkinshoyle.com/uploads/products/6500t-low-profile-rotating-crane-main-959820.jpg', features:['650 lb low-profile crane with high capacity','Horizontal folding boom for compact storage','Optional electric winch and remote control','Robust installation kit included','Engineered for frequent heavy use'] },
      '8000t':{ key:'8000t', title:'Model 8000T', capacity:800, type:'crane', mount:['deck','hardtop','foredeck'], link:'https://atkinshoyle.com/8000t-low-profile-crane-capcity-of-800-lb.html', image:'https://atkinshoyle.com/uploads/products/8000t-low-profile-rotating-crane-main-156577.jpg', features:['Exceptional 800 lb lifting capacity','Low-profile horizontal folding boom','Optional telescoping boom for added reach','12V electric winch operation available','Full installation kit and hardware included'] },
      '3000jr':{ key:'3000jr', title:'Model 3000Jr', capacity:300, type:'crane', mount:['deck','rail','transom'], link:'https://atkinshoyle.com/3000jr-crane-capacity-of-300-lb.html', image:'https://atkinshoyle.com/uploads/products/3000-junior-rotating-crane-243748.jpg', features:['Compact 300 lb junior crane for limited spaces','Lightweight yet durable construction','Easy-to-remove head for storage','Smooth manual winch with optional electric upgrade','Versatile mount options for decks and rails'] },
      '1400c':{ key:'1400c', title:'Model 1400 Crane', capacity:150, type:'crane', mount:['deck','rail','transom'], link:'https://atkinshoyle.com/1400-crane-capacity-150-lb.html', image:'https://atkinshoyle.com/uploads/products/1400-rotating-crane-main.jpg', features:['150 lb rotating crane — compact and nimble','Ideal for small outboards and accessories','Simple installation and low maintenance','Smooth rotation and secure locking','Pre-rigged kit for quick setup'] },
      '1900c':{ key:'1900c', title:'Model 1900 Crane', capacity:200, type:'crane', mount:['deck','rail','transom'], link:'https://atkinshoyle.com/1900-crane-capacity-of-200-lb.html', image:'https://atkinshoyle.com/uploads/products/no-title-74-main.jpg', features:['200 lb rotating crane with robust build','Adjustable arm angle for reach control','Durable components suited to marine use','Good balance of capacity and compactness','Supplied as a ready-to-install kit'] }
    };

    const RAIL_ORDER = ['120','1200r','1400r','1900r'];
    const FIXED_ORDER = ['1400f','1900f','2000','5000f'];
    const CRANE_ORDER = ['3000r','5000r','6500t','8000t'];
    const ALL_CRANE_ORDER = ['1400c','1900c','3000jr','3000r','5000r','6500t','8000t'];
    const POWER_OPTION_MODELS = new Set(['5000f','5000r','3000r','6500t','8000t']);
    window.pages = window.pages || { contact: 'https://atkinshoyle.com/contact.html' };

    // ===== RECOMMENDATION ENGINE =====
    function chooseRecommendation({weight, mount, engineWeight, winchPref, tenderType}){
      const dinghy = Number(weight || 0);
      const engine = Number(engineWeight || 0);
      const totalLift = dinghy + engine;
      const heavyLiftThreshold = 750;
      const craneOnlyMounts = new Set(['hardtop','foredeck']);

      // read system type (falls back to 'davits' if not present)
      const systemTypeEl = (typeof document !== 'undefined') ? document.querySelector('input[name="systemType"]:checked') : null;
      const systemType = systemTypeEl ? systemTypeEl.value : 'davits';
      const effectiveSystemType = craneOnlyMounts.has(mount) ? 'crane' : systemType;

      function computePowerText(modelKey){
        if(winchPref === 'electric' && POWER_OPTION_MODELS.has(modelKey)) return 'Configured with 12V electric winch';
        if(winchPref === 'manual') return 'Manual pulley system operation';
        if(winchPref === 'unsure' || winchPref === 'not sure') return 'Available in manual or electric configurations';
        return POWER_OPTION_MODELS.has(modelKey) ? 'Power Option Available' : 'Manual pulley system operation';
      }

      // Heavy-lift override (preserve behavior)
      if(totalLift > heavyLiftThreshold){
        if(mount === 'transom' || mount === 'deck'){
          const m = MODELS['5000f'];
          if(m){ const clone = Object.assign({}, m); clone.manualOrPower = computePowerText(clone.key); clone.totalLift = totalLift; clone.safetyMargin = Number(clone.capacity) - totalLift; return clone; }
        }
        if(mount === 'hardtop' || mount === 'foredeck'){
          const m = MODELS['8000t'];
          if(m){ const clone = Object.assign({}, m); clone.manualOrPower = computePowerText(clone.key); clone.totalLift = totalLift; clone.safetyMargin = Number(clone.capacity) - totalLift; return clone; }
        }
      }

      function firstMatchFromOrder(orderArray, predicate){
        for(const k of orderArray){ const m = MODELS[k]; if(!m) continue; if(predicate(m)) return m; }
        return null;
      }

      function modelMeets(m){
        if(Number(m.capacity) < totalLift) return false;
        if(craneOnlyMounts.has(mount)){
          if(m.type !== 'crane') return false;
          if(!m.mount || !m.mount.includes(mount)) return false;
          return true;
        }
        if(!m.mount || !m.mount.includes(mount)) return false;
        return true;
      }

      // Choose candidate order based on effective system type
      if(effectiveSystemType === 'crane'){
        // Special case: swim platform should still allow crane selection
        if(mount === 'swim'){
          // Iterate cranes in order and pick first with capacity >= totalLift
          for(const k of ALL_CRANE_ORDER){
            const m = MODELS[k];
            if(!m) continue;
            if(Number(m.capacity) >= totalLift){
              const clone = Object.assign({}, m);
              if(tenderType === 'hardskiff') clone.addons = ['Gunnel Lock'];
              clone.manualOrPower = computePowerText(clone.key);
              clone.totalLift = totalLift;
              clone.safetyMargin = Number(clone.capacity) - totalLift;
              clone.isFirstFit = true;
              return clone;
            }
          }
          // If we reach here, no crane meets the required lift (all cranes < required)
          return { key:'custom', title:'No crane fits your lifting requirements. Please contact our team for a custom solution.', why:'No standard crane meets the required lift for this configuration.', capacity:'Varies', type:'custom', link: pages.contact, totalLift };
        }

        const craneCandidate = firstMatchFromOrder(ALL_CRANE_ORDER, modelMeets);
        if(craneCandidate){
          const clone = Object.assign({}, craneCandidate);
          if(tenderType === 'hardskiff') clone.addons = ['Gunnel Lock'];
          clone.manualOrPower = computePowerText(clone.key);
          clone.totalLift = totalLift;
          clone.safetyMargin = Number(clone.capacity) - totalLift;
          clone.isFirstFit = true;
          return clone;
        }
        return { key:'custom', title:'No crane fits your lifting requirements. Please contact our team for a custom solution.', why:'Unable to find a standard crane that meets the required lift for this configuration.', capacity:'Varies', type:'custom', link: pages.contact, totalLift };
      }

      // If user selected Don't Know -> evaluate both davits and cranes and return smallest adequate model
      if(effectiveSystemType === 'unknown' || systemType === 'unknown'){
        const combined = Array.from(new Set([].concat(FIXED_ORDER, RAIL_ORDER, ALL_CRANE_ORDER)));
        function meetsUnknown(m){
          if(Number(m.capacity) < totalLift) return false;
          if(craneOnlyMounts.has(mount)){
            if(m.type !== 'crane') return false;
            if(!m.mount || !m.mount.includes(mount)) return false;
            return true;
          }
          // Allow cranes on swim platform (by SWL) even if mount list doesn't include 'swim'
          if(m.type === 'crane' && mount === 'swim') return true;
          if(!m.mount || !m.mount.includes(mount)) return false;
          return true;
        }
        const candidate = firstMatchFromOrder(combined, meetsUnknown);
        if(candidate){ const clone = Object.assign({}, candidate); if(tenderType === 'hardskiff') clone.addons = ['Gunnel Lock']; clone.manualOrPower = computePowerText(clone.key); clone.totalLift = totalLift; clone.safetyMargin = Number(clone.capacity) - totalLift; clone.isFirstFit = true; return clone; }
        return { key:'custom', title:'No standard model fits your lifting requirements. Please contact our team for a custom solution.', why:'Unable to find a standard model that meets the required lift for this configuration.', capacity:'Varies', type:'custom', link: pages.contact, totalLift };
      }

      // effectiveSystemType === 'davit' (only evaluate davit models)
      const davitCandidate = firstMatchFromOrder(FIXED_ORDER.concat(RAIL_ORDER), modelMeets);
      if(davitCandidate){
        const clone = Object.assign({}, davitCandidate);
        if(tenderType === 'hardskiff') clone.addons = ['Gunnel Lock'];
        clone.manualOrPower = computePowerText(clone.key);
        clone.totalLift = totalLift;
        clone.safetyMargin = Number(clone.capacity) - totalLift;
        clone.isFirstFit = true;
        return clone;
      }

      // If no davit found, fall back to cranes (maintain original fallback)
      const craneFallback = firstMatchFromOrder(ALL_CRANE_ORDER, modelMeets);
      if(craneFallback){
        const clone = Object.assign({}, craneFallback);
        clone.manualOrPower = computePowerText(clone.key);
        clone.totalLift = totalLift;
        clone.safetyMargin = Number(clone.capacity) - totalLift;
        clone.isFirstFit = true;
        return clone;
      }

      return { key:'custom', title:'No standard model fits your lifting requirements. Please contact our team for a custom solution.', why:'Unable to find a standard model that meets the required lift for this configuration.', capacity:'Varies', type:'custom', link: pages.contact, totalLift };
    }

    // Expose for debugging
    window.chooseRecommendation = chooseRecommendation;

    // ===== RENDERING =====
    function formatResult(rec, inputs){
      const modelName = rec.title || 'Recommended Model';
      const rated = rec.capacity ? `${rec.capacity} lbs (Safe Working Load)` : (rec.ratedCapacity || 'Varies');
      function mountLabel(code){ if(!code) return 'Not specified'; const map = {swim:'Swim Platform', transom:'Transom', rail:'Rail', deck:'Deck', hardtop:'Hardtop', foredeck:'Foredeck'}; return map[code] || String(code).replace(/^[a-z]/, s=>s.toUpperCase()); }
      const mountType = (inputs && inputs.mount) ? mountLabel(inputs.mount) : (rec.mount || (rec.type === 'crane' ? 'Deck / Custom' : 'Rail / Transom / Deck'));
      const imgUrl = rec.image || '';
      const features = rec.features || (MODELS[rec.key] ? MODELS[rec.key].features : []);
      const featuresHTML = `
        <div itemprop="description">
          <h4 style="margin-top:12px;color:var(--navy);font-size:14px">Key Features</h4>
          <ul class="key-features">
            ${features.map(f => `<li>${f}</li>`).join('')}
          </ul>
        </div>
      `;
      const bestFor = [];
      if(inputs && inputs.tenderType){ const mapTender = {inflatable:'Inflatable tenders', rib:'RIBs', hardskiff:'Hard skiffs'}; const tenderLabel = mapTender[inputs.tenderType] || String(inputs.tenderType); bestFor.push(`${tenderLabel} — up to ${rec.capacity || rec.swl || 'Varies'} lbs`); }
      if(inputs && inputs.mount){ const mountLabelShort = mountLabel(inputs.mount); bestFor.push(`${mountLabelShort} mounting applications`); }
      if(inputs && inputs.winchPref === 'electric'){ bestFor.push('Electric lift setup'); }
      const bestForHTML = bestFor.length ? `
        <h4 style="margin-top:12px;color:var(--navy);font-size:14px">Best For:</h4>
        <ul style="padding-left:18px;margin-top:6px;color:var(--muted);font-size:13px">
          ${bestFor.map(b => `<li>${b}</li>`).join('')}
        </ul>
      ` : '';
      const safety = (typeof rec.safetyMargin !== 'undefined' && rec.safetyMargin !== null) ? rec.safetyMargin : (Number(rec.capacity||0) - (Number(inputs.weight||0) + Number(inputs.engineWeight||0)));
      const requiredLift = rec.totalLift || (Number(inputs.weight||0) + Number(inputs.engineWeight||0));
      const explanation = rec.isFirstFit ? `<div style="margin-top:8px;color:var(--muted);font-size:13px">This model is recommended because your required lift of ${requiredLift} lbs exceeds the capacity of smaller models.</div>` : '';

      const recommendedCard = `
        <div class="recommended-card" itemscope itemtype="https://schema.org/Product" style="border:1px solid var(--border);padding:12px;border-radius:8px;background:#fff;margin-bottom:12px">

          <img itemprop="image" src="${imgUrl}" alt="${modelName}" class="recommendation-image">

          <div style="color:var(--navy);font-weight:700;font-size:12px">RECOMMENDED SOLUTION</div>
          <div itemprop="name" style="font-family:'Playfair Display';font-size:24px;color:var(--navy);font-weight:800;margin-top:6px">${modelName}</div>

          <div style="margin-top:10px;color:var(--muted);font-size:14px">
            <div><strong>Rated Capacity:</strong> ${rated}</div>
            <div style="margin-top:6px"><strong>Ideal Mounting:</strong> ${mountType}</div>
          </div>

          ${bestForHTML}

          ${featuresHTML}

          <div class="cta-buttons">
            <a id="viewProductBtn" class="cta-button" href="${rec.link}" target="_blank">View Product Page</a>
            <a id="requestQuoteBtn" class="cta-button" href="https://atkinshoyle.com/contact.html?source=davit-selector&intent=quote" target="_blank" rel="noopener noreferrer">Request a Quote</a>
            <a id="contactBtn" class="cta-button" href="https://atkinshoyle.com/contact.html?source=davit-selector&intent=contact" target="_blank" rel="noopener noreferrer">Contact Us</a>
          </div>

          ${rec.addons && rec.addons.length ? `<div style="margin-top:8px;color:var(--navy);font-weight:700">Add-ons</div><div style="color:var(--muted);font-size:13px">${rec.addons.join(', ')}</div>` : ''}

          <div style="margin-top:8px;color:var(--muted);font-size:13px">${rec.manualOrPower || ''}</div>

          <div class="recommendation-summary">
            <div style="margin-top:8px;color:var(--muted);font-size:13px">
              <div style="font-weight:700">Required Lift Capacity: ${requiredLift} lbs</div>
              <div style="font-weight:800;margin-top:6px">Selected Model Capacity: ${rec.capacity || rec.swl} lbs</div>
              <div style="margin-top:6px; ${safety>0 ? 'color:green' : 'color:var(--muted)'}">Safety Margin: ${safety} lbs</div>
              ${explanation}
            </div>

            <div style="margin-top:8px;color:var(--muted);font-size:12px">✓ Marine-grade construction&nbsp;&nbsp; ✓ Built for harsh marine environments&nbsp;&nbsp; ✓ Backed by manufacturer warranty</div>
          </div>
        </div>
      `;

      return recommendedCard;
    }

    window.formatResult = formatResult;

    // Find other suitable models (up to `limit`) that meet the same inputs and filters
    function findOtherModels(inputs, excludeKey, limit = 4){
      const dinghy = Number(inputs.weight || 0);
      const engine = Number(inputs.engineWeight || 0);
      const totalLift = dinghy + engine;
      const mount = inputs.mount;
      const tenderType = inputs.tenderType;
      const winchPref = inputs.winchPref;
      const heavyLiftThreshold = 750;
      const craneOnlyMounts = new Set(['hardtop','foredeck']);

      // determine system type like chooseRecommendation (but don't alter primary logic)
      const systemTypeEl = (typeof document !== 'undefined') ? document.querySelector('input[name="systemType"]:checked') : null;
      const systemType = systemTypeEl ? systemTypeEl.value : 'davits';
      const effectiveSystemType = craneOnlyMounts.has(mount) ? 'crane' : systemType;

      const combined = Array.from(new Set([].concat(FIXED_ORDER, RAIL_ORDER, ALL_CRANE_ORDER)));
      const results = [];

      function allowedByMount(m){
        if(Number(m.capacity) < totalLift) return false;
        if(craneOnlyMounts.has(mount)){
          if(m.type !== 'crane') return false;
          if(!m.mount || !m.mount.includes(mount)) return false;
          return true;
        }
        // allow cranes on swim platform by SWL
        if(m.type === 'crane' && mount === 'swim') return true;
        if(!m.mount || !m.mount.includes(mount)) return false;
        return true;
      }

      for(const k of combined){
        const m = MODELS[k];
        if(!m) continue;
        if(m.key === excludeKey) continue;
        if(!allowedByMount(m)) continue;
        // respect user's system selection
        if(effectiveSystemType === 'crane' && m.type !== 'crane') continue;
        if(effectiveSystemType === 'davits' && m.type !== 'davit') continue;

        const clone = Object.assign({}, m);
        clone.manualOrPower = (function(modelKey){
          if(winchPref === 'electric' && POWER_OPTION_MODELS.has(modelKey)) return 'Configured with 12V electric winch';
          if(winchPref === 'manual') return 'Manual pulley system operation';
          if(winchPref === 'unsure' || winchPref === 'not sure') return 'Available in manual or electric configurations';
          return POWER_OPTION_MODELS.has(modelKey) ? 'Power Option Available' : 'Manual pulley system operation';
        })(clone.key);
        clone.totalLift = totalLift;
        clone.safetyMargin = Number(clone.capacity) - totalLift;

        results.push(clone);
        if(results.length >= limit) break;
      }

      return results;
    }

    // ===== EVENT HANDLERS =====
    document.getElementById('recommendBtn').addEventListener('click', ()=>{
      const weight = Number(document.getElementById('dinghyWeight').value) || 0;
      const mount = document.querySelector('input[name="mount"]:checked').value;
      const tenderType = document.getElementById('tenderType').value;
      const engineWeight = document.getElementById('engineWeight').value || 0;
      const winchPref = document.getElementById('winchPref').value;
      const inputs = {weight, mount, tenderType, engineWeight, winchPref};
      const rec = chooseRecommendation(inputs);

      const area = document.getElementById('resultArea');
      area.innerHTML = formatResult(rec, inputs);
      window._lastInputs = inputs;
      window._lastRec = rec;

      const quoteArea = document.getElementById('quoteArea');
      quoteArea.style.display = 'block';

      // Remove existing other-options UI if present
      const prevBtn = document.getElementById('otherOptionsBtn');
      if(prevBtn) prevBtn.remove();
      const prevWrap = document.getElementById('otherOptionsWrap');
      if(prevWrap) prevWrap.remove();

      // Create toggle button below the recommendation card
      const btn = document.createElement('button');
      btn.id = 'otherOptionsBtn';
      btn.type = 'button';
      btn.className = 'cta-button';
      btn.style.marginTop = '8px';
      btn.textContent = 'View Other Suitable Options';

      // Container for other options
      const wrap = document.createElement('div');
      wrap.id = 'otherOptionsWrap';
      wrap.style.display = 'none';
      wrap.style.marginTop = '12px';

      // Toggle handler
      btn.addEventListener('click', ()=>{
        if(wrap.style.display === 'none'){
          // populate
          wrap.innerHTML = '';
          const others = findOtherModels(inputs, rec.key, 4);
          if(!others || others.length === 0){
            wrap.innerHTML = '<div style="color:var(--muted);font-size:13px">No additional standard models match your requirements.</div>';
          } else {
            const list = document.createElement('div');
            list.style.display = 'grid';
            list.style.gridTemplateColumns = '1fr';
            list.style.gap = '10px';
            others.forEach(m => {
              const item = document.createElement('div');
              item.style.border = '1px solid var(--border)';
              item.style.padding = '10px';
              item.style.borderRadius = '6px';
              item.style.background = '#fff';

              const title = document.createElement('div');
              title.style.fontWeight = '700';
              title.style.color = 'var(--navy)';
              title.textContent = m.title || m.key;

              const cap = document.createElement('div');
              cap.style.fontSize = '13px';
              cap.style.color = 'var(--muted)';
              cap.style.marginTop = '6px';
              cap.textContent = `Rated Capacity: ${m.capacity} lbs (Safe Working Load)`;

              const link = document.createElement('a');
              link.className = 'cta-button';
              link.href = m.link || pages.contact;
              link.target = '_blank';
              link.style.marginTop = '8px';
              link.textContent = 'View Product Page';

              item.appendChild(title);
              item.appendChild(cap);
              item.appendChild(link);
              list.appendChild(item);
            });
            wrap.appendChild(list);
          }
          wrap.style.display = 'block';
          btn.textContent = 'Hide Other Suitable Options';
        } else {
          wrap.style.display = 'none';
          btn.textContent = 'View Other Suitable Options';
        }
      });

      // Insert button and wrap after the result area content
      const parent = area;
      parent.appendChild(btn);
      parent.appendChild(wrap);
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      document.getElementById('dinghyWeight').value = 300;
      document.querySelector('input[name="mount"][value="swim"]').checked = true;
      document.getElementById('tenderType').value = 'inflatable';
      document.getElementById('engineWeight').value = '0';
      document.getElementById('winchPref').value = 'unsure';
      document.getElementById('resultArea').innerHTML = `<div class="product-title">No selection yet</div><div class="product-sub">Fill the form and click <strong>Get Recommendation</strong> to see the best fit for your boat.</div>`;
      document.getElementById('quoteArea').style.display = 'none';
    });
  </script>
</body>
</html>


